<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Students â€” Year</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/style.css" type="text/css" media="all">
	<link rel="stylesheet" href="/css/cards.css" type="text/css" media="all">
	<link rel="stylesheet" href="/css/student.css" type="text/css" media="all">
	<link rel="stylesheet" href="/css/profiles-common.css" type="text/css" media="all">
	<link rel="stylesheet" href="/css/common-header.css" type="text/css" media="all">
	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800" type="text/css">
	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700" type="text/css">

</head>
<body>
	<!-- Compact Header -->
	<div class="header page-strap" id="home">
		<div class="top-bar">
			<div class="container">
				<!-- Logo -->
				<div class="logo">
					<p><a href="/index.html">Center for Theoretical<br />Astrophysics</a></p>
					<br>
					<p class="subtitle"><a href="http://cta.lanl.gov">Los Alamos National Laboratory</a></p>
				</div>
				<!-- //Logo -->
				<div class="info">
					<!-- Email -->
					<div class="email">
						<p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span><a href="mailto:CTA_recruitment@lanl.gov">CTA_recruitment@lanl.gov</a></p>
					</div>
					<!-- //Email -->
				</div>
				<div class="clearfix"></div>
			</div>
		</div>
		<div class="strap-bg" aria-hidden="true"></div>
	</div>
	<!-- //Compact Header -->
	<!-- Team -->
	<div class="team" id="team">
		<div class="container">
			<p style="text-align:left;margin:12px 0 10px;"><a href="/students/students.html">&larr; Back to Students</a></p>
			<h3 class="title">STUDENTS OF <span id="year"></span></h3>
			<p class="underline1"></p>
			<div class="student-card-grid" id="grid"></div>
			<h3 class="title" style="margin-top:28px;">OTHER YEARS</h3>
			<p class="underline1"></p>
			<ul class="years-grid" id="years-list"></ul>
		</div>
	</div>
	<!-- //Team -->
	<!-- Contact -->
	<div id="cta-contact"></div>
	<!-- //Contact -->
	<!-- Footer -->
	<div id="cta-footer"></div>
	<!-- //Footer -->
	<script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
	<script src="/js/profile-utils.js"></script>
	<script>
	(function(){
		const DATA_BASE    = '/data';
		const IMG_ROSTER   = '/students/images/roster';
		const IMG_YEARS    = '/students/images';
		const DEFAULT_IMG  = '/students/images/cta-default.jpg';

		function qs(s){
			return document.querySelector(s);
		}
		function el(t,a={},c=[]){ const n=document.createElement(t);
			Object.entries(a).forEach(([k,v])=>v!=null&&n.setAttribute(k,v));
			(Array.isArray(c)?c:[c]).forEach(x=>{
				if(x!=null) n.appendChild(typeof x==='string'?document.createTextNode(x):x); 
			});
			return n;
		}
		async function fetchYAML(p){
			const r=await fetch(p);
			const t=await r.text();
			return jsyaml.load(t)||{};
		}
		function imageCandidates(slug, person, stint, years){
			const exts = ['.jpg', '.png', '.jpeg'];
			const out = [];
			// 1) explicit per-year override
			if (stint && stint.card_image) out.push(stint.card_image);
			if (stint && stint.photo_override) out.push(stint.photo_override); // alias, if present
			// 2) roster-provided photo
			if (person && person.photo) out.push(person.photo);
			// 3) canonical roster folder
			for (const ext of exts) out.push(`${IMG_ROSTER}/${slug}${ext}`);
			// 4) scan each year folder (use given order in `years`; newest to oldest)
			for (const y of years) for (const ext of exts)
				out.push(`${IMG_YEARS}/${y}/${slug}${ext}`);
			// 5) default
			out.push(DEFAULT_IMG);
			return Array.from(new Set(out.filter(Boolean)));
		}
		function firstReachable(urls){
			return new Promise(resolve=>{
				let i=0,img=new Image();
				const next=()=>{
					if(i>=urls.length) return resolve(DEFAULT_IMG);
					const u=urls[i++];
					img.onload=()=>resolve(u);
					img.onerror=next;
					img.src=u;
				};
				next();
			});
		}
		function sortKey(stint, bySlug){
			const p=bySlug[stint.slug]||{}; 
			return (p.sort_key||p.display_name||stint.slug||'').toLowerCase();
		}
		function formatNameFromSlug(str) {
			return str
			.split('-')
			.map(word => {
				if (!word) return ''; // Handle empty segments safely
				const lower = word.toLowerCase();
				return lower.charAt(0).toUpperCase() + lower.slice(1);
			})
			.join(' ');
		}
		function card(stint, person, years){
			const slug=stint.slug, name=(person && (person.display_name||person.name))||formatNameFromSlug(slug);
			const href = 'profile.html?slug=' + encodeURIComponent(slug);
			const node = el('div',{class:'student-card-wrap'},[
				el('a',{class:'student-card',href},[
					el('img',{class:'student-photo',src:DEFAULT_IMG,alt:name,loading:'lazy'}),
					el('div',{class:'student-meta'},[
						el('h4',{class:'student-name'},name),
						stint.university?el('span',{class:'student-univ'},stint.university):null,
						stint.role?el('span',{class:'student-role'},stint.role):null,
						(stint.division||stint.group_code)?el('span',{class:'student-group'},
							`${stint.division||''}${(stint.division&&stint.group_code)?', ':''}${stint.group_code||''}`):null,
						stint.focus?el('p',{class:'student-focus'},stint.focus):null
					])
				])
			]);
			firstReachable(imageCandidates(slug, person, stint, years)).then(u=>{ node.querySelector('img').src=u; });
			return node;
		}
		async function main(){
			const params = new URL(location.href).searchParams;
			const y = params.get('y');
			if(!y){ location.replace('/students/students.html'); return; }
			qs('#year').textContent = y;
			const years = (await fetchYAML(`${DATA_BASE}/students/student_years.yml`)).years || [];
			const roster = await fetchYAML(`${DATA_BASE}/students/student_roster.yml`);
			const bySlug = Object.fromEntries((Array.isArray(roster)?roster:[]).map(p=>[p.slug,p]));
			const stints = await fetchYAML(`${DATA_BASE}/students/students_${y}.yml`);
			const grid = qs('#grid');
			(Array.isArray(stints)?stints:[]).slice()
				.sort((a,b)=>sortKey(a, bySlug).localeCompare(sortKey(b, bySlug)))
				.forEach(stint=>grid.appendChild(card(stint, bySlug[stint.slug], years)));
			// Other years list
			const list = qs('#years-list');
			years.forEach(yr=>{
				const li = el('li', {}, el('a', {href:`/students/year.html?y=${yr}`}, `${yr}`));
				if (yr != y) list.appendChild(li);
			});
		}
		main().catch(console.error);
	})();
		// Load partials
		ProfileUtils.loadPartial('#cta-contact', '/partials/contact.html');
		ProfileUtils.loadPartial('#cta-footer', '/partials/footer.html');

		// Initialize strap height syncing
		ProfileUtils.initStrapSync();
	</script>
</body>
</html>