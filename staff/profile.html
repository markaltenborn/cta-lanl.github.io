<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Profile — CTA</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/style.css"  type="text/css" media="all">
	<link rel="stylesheet" href="/css/cards.css" type="text/css" media="all">
	<link rel="stylesheet" href="/css/staff.css" type="text/css" media="all">

	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800" type="text/css">
	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700" type="text/css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
</head>
<body>
	<!-- Compact Header -->
	<div class="header page-strap" id="home">
		<div class="top-bar">
			<div class="container">
				<!-- Logo -->
				<div class="logo">
					<p><a href="/index.html">Center for Theoretical<br />Astrophysics</a></p>
					<br>
					<p class="subtitle"><a href="http://cta.lanl.gov">Los Alamos National Laboratory</a></p>
				</div>
				<!-- //Logo -->
				<div class="info">
					<!-- Email -->
					<div class="email">
						<p>
							<span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>
							<a href="mailto:CTA_recruitment@lanl.gov">CTA_recruitment@lanl.gov</a>
						</p>
					</div>
					<!-- //Email -->
				</div>
				<div class="clearfix"></div>
			</div>
		</div>
		<div class="strap-bg" aria-hidden="true"></div>
	</div>
	<!-- //Compact Header -->

	<!-- Team / Profile -->
	<div class="team" id="team">
		<div class="container">
			<p style="text-align:left;margin:12px 0 10px;">
                <a href="/staff/people.html">&larr; Back to Members</a>
            </p>

			<h1 class="profile-name" id="profile-name"></h1>

			<div class="profile-layout">
				<!-- Left column -->
				<div>
					<img class="profile-photo" id="profile-photo" alt="" loading="lazy">
					<div class="profile-affil">
						<strong>AFFILIATION:</strong>
						<span id="profile-affiliation"></span>
					</div>
				</div>
				<!-- //Left column -->

				<!-- Right column -->
				<aside class="contact-card" aria-label="Contact information">
					<h4>Contact</h4>
					<ul id="contact-list"><!-- JS inserts links --></ul>
				</aside>
				<!-- //Right column -->
			</div>

			<!-- Bio -->
			<div class="profile-bio" id="profile-bio" style="display:none;"></div>
			<!-- //Bio -->

			<!-- Interests -->
			<h3 class="title" id="interests-title" style="margin-top:20px; display:none;">INTERESTS</h3>
			<p class="underline1"></p>
			<ul class="postdoc-list profile-interests" id="profile-interests" style="display:none;"></ul>
			<!-- //Interests -->
		</div>
	</div>
	<!-- //Team -->

	<!-- Contact -->
	<div id="cta-contact"></div>
	<!-- //Contact -->

	<!-- Footer -->
	<div id="cta-footer"></div>
	<!-- //Footer -->

	<script>
	(async function(){
		const DATA_BASE   = '/data';
		const IMG_ROSTER  = '/staff/images/roster';
		const IMG_ROOT    = '/staff/images';
		const DEFAULT_IMG = '/staff/images/cta-default.jpg';

		function a(href, text){
			const n = document.createElement('a');
			n.href = href;
			n.target = '_blank';
			n.rel = 'noopener';
			n.textContent = text;
			return n;
		}

		async function fetchYAML(path){
			const res = await fetch(path, { cache: 'no-store' });
			const txt = await res.text();
			return jsyaml.load(txt) || {};
		}

		function imageCandidates(slug, person){
			const exts = ['.jpg', '.png', '.jpeg'];
			const out  = [];

			// 1) explicit photo from roster, if provided
			if (person && person.photo) out.push(person.photo);

			// 2) canonical roster folder
			for (const ext of exts) out.push(`${IMG_ROSTER}/${slug}${ext}`);

			// 3) flat staff images folder
			for (const ext of exts) out.push(`${IMG_ROOT}/${slug}${ext}`);

			// 4) default
			out.push(DEFAULT_IMG);

			return Array.from(new Set(out.filter(Boolean)));
		}

		function formatNameFromSlug(str) {
			if (!str) return '';
			return String(str)
				.split('-')
				.map(word => {
					if (!word) return '';
					const lower = word.toLowerCase();
					return lower.charAt(0).toUpperCase() + lower.slice(1);
				})
				.join(' ');
		}

		function firstReachable(urls){
			return new Promise(resolve => {
				let i = 0;
				const img = new Image();
				const next = () => {
					if (i >= urls.length) return resolve(DEFAULT_IMG);
					const u = urls[i++];
					img.onload = () => resolve(u);
					img.onerror = next;
					img.src = u;
				};
				next();
			});
		}

		const params = new URL(location.href).searchParams;
		const slug   = params.get('slug');

		if (!slug){
			location.replace('/index.html#team');
			return;
		}

		// Load staff roster and locate this person
		const roster = await fetchYAML(`${DATA_BASE}/staff/staff_roster.yml`);
		const people = Array.isArray(roster) ? roster : [];
		const person = people.find(p => p.slug === slug) || {};

		const displayName =
			person.display_name ||
			person.name ||
			formatNameFromSlug(slug);

		document.title = `${displayName} — CTA Profile`;
		document.getElementById('profile-name').textContent = displayName;

		// Photo
		const imgEl = document.getElementById('profile-photo');
		imgEl.src = DEFAULT_IMG;
		firstReachable(imageCandidates(slug, person)).then(u => { imgEl.src = u; });

		// Affiliation: combine role + division if present
		const affSpan = document.getElementById('profile-affiliation');
		const affParts = [];
		if (person.role && String(person.role).trim()) {
			affParts.push(String(person.role).trim());
		}
		if (person.division && String(person.division).trim()) {
			affParts.push(String(person.division).trim());
		}
		affSpan.textContent = affParts.join(' — ') || '—';

		// Bio
		const bioText = (person.bio && String(person.bio).trim()) || '';
		if (bioText){
			const bioEl = document.getElementById('profile-bio');
			bioEl.textContent = bioText;
			bioEl.style.display = '';
		}

		// Interests / focus
		(function renderInterests(){
			const titleEl = document.getElementById('interests-title');
			const listEl  = document.getElementById('profile-interests');
			if (!titleEl || !listEl) return;

			const toItems = (v) => {
				if (!v) return [];
				if (Array.isArray(v)) {
					return v.map(s => String(s).trim()).filter(Boolean);
				}
				return String(v)
					.split(/[,;|\n]/)
					.map(s => s.trim())
					.filter(Boolean);
			};

			let items = toItems(person.interests);
			if (!items.length && person.focus){
				items = toItems(person.focus);
			}

			const seen = new Set();
			items = items.filter(s => {
				const k = s.toLowerCase();
				if (seen.has(k)) return false;
				seen.add(k);
				return true;
			});

			if (!items.length) return;

			titleEl.style.display = '';
			listEl.style.display  = '';
			listEl.innerHTML = '';

			items.forEach(txt => {
				const li = document.createElement('li');
				li.textContent = txt;
				listEl.appendChild(li);
			});
		})();

		// Contact entries
		const list = document.getElementById('contact-list');
		list.innerHTML = '';

		if (person.email){
			const li = document.createElement('li');
			li.appendChild(a(`mailto:${person.email}`, person.email));
			list.appendChild(li);
		}
		if (person.phone){
			const li = document.createElement('li');
			li.textContent = person.phone;
			list.appendChild(li);
		}
		if (person.lanl){
			const li = document.createElement('li');
			li.appendChild(a(person.lanl, 'LANL Profile'));
			list.appendChild(li);
		}
		if (person.scholar){
			const li = document.createElement('li');
			li.appendChild(a(person.scholar, 'Google Scholar'));
			list.appendChild(li);
		}
		if (person.ads){
			const li = document.createElement('li');
			li.appendChild(a(person.ads, 'NASA ADS'));
			list.appendChild(li);
		}
	})();
	(function syncStrap(){
		function update(){
			var tb = document.querySelector('.page-strap .top-bar');
			var bg = document.querySelector('.page-strap .strap-bg');
			if (tb && bg) bg.style.height = tb.offsetHeight + 'px';
		}
		window.addEventListener('load', update);
		window.addEventListener('resize', update);
	})();
	</script>
	<script>
	$(function () {
	    $("#cta-contact").load("/partials/contact.html");
	});
	</script>
	<script>
	$(function () {
	    $("#cta-footer").load("/partials/footer.html");
	});
	</script>
</body>
</html>