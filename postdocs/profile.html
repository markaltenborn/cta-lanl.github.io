<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Profile — CTA</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/style.css" 			type="text/css" media="all">
	<link rel="stylesheet" href="/css/cards.css"				type="text/css" media="all">
	<link rel="stylesheet" href="/css/postdoc.css" 			type="text/css" media="all">
	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800" type="text/css">
	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700" type="text/css">
	<style>
		.profile-hero{display:flex;flex-wrap:wrap;gap:18px;align-items:flex-start;margin:10px 0 24px;}
		.profile-hero img{max-width:260px;width:100%;border-radius:8px;object-fit:cover;aspect-ratio:4/3;}
		.profile-meta{flex:1;min-width:260px;}
		.profile-meta h1{margin:0 0 10px;font-size:28px;line-height:1.25;}
		.quick-links a{margin-right:10px;}
	</style>
</head>
<body>
	<!-- Compact Header -->
	<div class="header page-strap" id="home">
		<div class="top-bar">
			<div class="container">
				<!-- Logo -->
				<div class="logo">
					<p><a href="/index.html">Center for Theoretical<br />Astrophysics</a></p>
					<br>
					<p class="subtitle"><a href="http://cta.lanl.gov">Los Alamos National Laboratory</a></p>
				</div>
				<!-- //Logo -->
				<div class="info">
					<!-- Email -->
					<div class="email">
						<p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span><a href="mailto:CTA_recruitment@lanl.gov">CTA_recruitment@lanl.gov</a></p>
					</div>
					<!-- //Email -->
				</div>
				<div class="clearfix"></div>
			</div>
		</div>
		<div class="strap-bg" aria-hidden="true"></div>
	</div>
	<!-- //Compact Header -->
	<!-- Team -->
	<div class="team" id="team">
		<div class="container">
			<p style="text-align:left;margin:12px 0 10px;"><a href="/postdocs/postdocs.html">&larr; Back to Postdocs</a></p>
			<h1 class="profile-name" id="profile-name"></h1>
			<div class="profile-layout">
				<!-- Left column -->
				<div>
					<img class="profile-photo" id="profile-photo" alt="" loading="lazy">
					<div class="profile-affil"><strong>AFFILIATION:</strong> <span id="profile-affiliation"></span></div>
				</div>
				<!-- //Left column -->
				<!-- Right column -->
				<aside class="contact-card" aria-label="Contact information">
					<h4>Contact</h4>
					<ul id="contact-list"><!-- JS inserts Email, Phone, Scholar, ADS --></ul>
				</aside>
				<!-- //Right column -->
			</div>
			<!-- Bio -->
			<div class="profile-bio" id="profile-bio" style="display:none;"></div>
			<!-- //Bio -->
			<!-- Interests -->
			<h3 class="title" id="interests-title" style="margin-top:20px; display:none;">INTERESTS</h3>
			<p class="underline1"></p>
			<ul class="postdoc-list profile-interests" id="profile-interests" style="display:none;"></ul>
			<!-- //Interests -->
			<!-- Participation -->
			<h3 class="title" style="margin-top:28px;">CTA PARTICIPATION</h3>
			<p class="underline1"></p>
			<ul class="postdoc-list profile-stints" id="stints"></ul>
			<!-- //Participation -->
		</div>
	</div>
	<!-- //Team -->
	<!-- Contact -->
	<div id="cta-contact"></div>
	<!-- //Contact -->
	<!-- Footer -->
	<div id="cta-footer"></div>
	<!-- //Footer -->
	<script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
	<script>
	(async function(){
		const DATA_BASE    = '/data';
		const IMG_ROSTER   = '/postdocs/images/roster';
		const IMG_YEARS    = '/postdocs/images';
		const DEFAULT_IMG  = '/postdocs/images/cta-default.jpg';

		function a(href, text){
			const n=document.createElement('a');
			n.href=href;
			n.target='_blank';
			n.rel='noopener';
			n.textContent=text;
			return n;
		}
		async function fetchYAML(p){
			const r=await fetch(p,{cache:'no-store'});
			const t=await r.text();
			return jsyaml.load(t)||{};
		}
		function imageCandidates(slug, person, years){
			const exts = ['.jpg', '.png', '.jpeg'];
			const out = [];
			// 1) roster-provided photo
			if (person && person.photo) out.push(person.photo);
			// 2) canonical roster folder
			for (const ext of exts) out.push(`${IMG_ROSTER}/${slug}${ext}`);
			// 3) scan each year folder
			for (const y of years) for (const ext of exts)
				out.push(`${IMG_YEARS}/${y}/${slug}${ext}`);
			// 4) default
			out.push(DEFAULT_IMG);
			return Array.from(new Set(out.filter(Boolean)));
		}
		function formatNameFromSlug(str) {
			return str
			.split('-') // Split by hyphen
			.map(word => {
				if (!word) return ''; // Handle empty segments safely
				const lower = word.toLowerCase(); // Normalize to lowercase
				return lower.charAt(0).toUpperCase() + lower.slice(1);
			})
			.join(' ');
		}
		function firstReachable(urls){
			return new Promise(resolve=>{
				let i=0,img=new Image();
				const next=()=>{
					if(i>=urls.length) return resolve(DEFAULT_IMG);
					const u=urls[i++];
					img.onload=()=>resolve(u);
					img.onerror=next;
					img.src=u;
				};
				next();
			});
		}
		const params = new URL(location.href).searchParams;
		const slug = params.get('slug');
		if(!slug){
			location.replace('/postdocs/postdocs.html');
			return;
		}
		const roster = await fetchYAML(`${DATA_BASE}/postdocs/postdoc_roster.yml`);
		const person = (Array.isArray(roster)?roster:[]).find(p=>p.slug===slug) || {};
		document.title = `${person.display_name || formatNameFromSlug(slug)} — CTA Profile`;
		document.getElementById('profile-name').textContent = person.display_name || formatNameFromSlug(slug);
		const years = (await fetchYAML(`${DATA_BASE}/postdocs/postdoc_years.yml`)).years || [];
		// Photo
		const imgEl = document.getElementById('profile-photo'); imgEl.src = DEFAULT_IMG;
		firstReachable(imageCandidates(slug, person, years)).then(u=> imgEl.src = u);
		// Load all years to determine participation and latest affiliation
		const lists = await Promise.all(
			years.map(y => fetchYAML(`${DATA_BASE}/postdocs/postdocs_${y}.yml`).then(list => ({y, list})))
		);
		const myYears = lists
			.filter(e => (Array.isArray(e.list)?e.list:[]).some(s => s.slug === slug))
			.map(e => e.y);
		// Latest affiliation from most-recent year
		let latestAff = '';
		let latestStint = null;
		if (myYears.length){
			const latestYear = myYears[0];
			const latestList = (lists.find(e => e.y === latestYear) || {}).list || [];
			latestStint = latestList.find(s => s.slug === slug) || null;
			latestAff = (latestStint && latestStint.university) ? latestStint.university : '';
		}
		document.getElementById('profile-affiliation').textContent = latestAff || '—';

		(function renderInterests(){
			const titleEl = document.getElementById('interests-title');
			const listEl	= document.getElementById('profile-interests');
			if (!titleEl || !listEl) return;
			const toItems = (v) => {
				if (!v) return [];
				if (Array.isArray(v)) return v.map(s => String(s).trim()).filter(Boolean);
				return String(v).split(/[,;|\n]/).map(s => s.trim()).filter(Boolean);
			};
			let items = toItems(person.interests);
			if (!items.length && latestStint && latestStint.focus){
				items = toItems(latestStint.focus);
			}
			const seen = new Set();
			items = items.filter(s => {
				const k = s.toLowerCase();
				if (seen.has(k)) return false;
				seen.add(k);
				return true;
			});
			if (!items.length) return; // nothing to show
			titleEl.style.display = '';
			listEl.style.display	= '';
			listEl.innerHTML = '';
			items.forEach(txt => {
				const li = document.createElement('li');
				li.textContent = txt;
				listEl.appendChild(li);
			});
		})();
		// Bio will appear once when data is added to roster
		const bioText = (person.bio && String(person.bio).trim()) || '';
		if (bioText){
			const bioEl = document.getElementById('profile-bio');
			bioEl.textContent = bioText;
			bioEl.style.display = '';
		}
		// Contact entries
		const list = document.getElementById('contact-list'); list.innerHTML='';
		if (person.email){
			const li=document.createElement('li');
			li.appendChild(a(`mailto:${person.email}`, person.email));
			list.appendChild(li);
		}
		if (person.phone){
			const li=document.createElement('li');
			li.textContent = person.phone;
			list.appendChild(li);
		}
		if (person.scholar){
			const li=document.createElement('li');
			li.appendChild(a(person.scholar, 'Google Scholar'));
			list.appendChild(li);
		}
		if (person.ads){
			const li=document.createElement('li');
			li.appendChild(a(person.ads, 'NASA ADS'));
			list.appendChild(li);
		}
		// Participation newest to oldest
		const ul = document.getElementById('stints'); ul.innerHTML='';
		myYears.forEach(y => {
			const li=document.createElement('li');
			const L=a(`/postdocs/year.html?y=${y}`, `${y}`);
			li.appendChild(L); ul.appendChild(li);
		});
	})();
		(function syncStrap(){
			function update(){
				var tb = document.querySelector('.page-strap .top-bar');
				var bg = document.querySelector('.page-strap .strap-bg');
				if (tb && bg) bg.style.height = tb.offsetHeight + 'px';
			}
			window.addEventListener('load', update);
			window.addEventListener('resize', update);
		})();
	</script>
	<script>
	$(function () {
	    $("#cta-contact").load("/partials/contact.html");
	});
	</script>
	<script>
	$(function () {
	    $("#cta-footer").load("/partials/footer.html");
	});
	</script>
</body>
</html>
